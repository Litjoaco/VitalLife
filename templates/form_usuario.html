{% extends "base.html" %}
{% load static %}

{% block header %}
    <header class="navbar navbar-expand-lg navbar-light bg-white border-bottom" aria-label="Barra de navegación del panel de admin">
        <div class="container">
            <a class="navbar-brand" href="{% url 'paneladmin:admin_dashboard' %}">
                <img src="{% static 'img/logov.png' %}" alt="VitalLife Logo" class="logo">
                <span>VitalLife Admin</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#adminNavbar" aria-controls="adminNavbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="adminNavbar">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="{% url 'paneladmin:admin_dashboard' %}">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link active" aria-current="page" href="{% url 'paneladmin:lista_usuarios' %}">Usuarios</a></li>
                    <li class="nav-item"><a class="nav-link" href="{% url 'paneladmin:lista_especialidades' %}">Especialidades</a></li>
                </ul>
                <a href="{% url 'usuario:panel_inicio' %}" class="btn btn-outline-secondary me-3">Volver al Panel</a>
            </div>
        </div>
    </header>
{% endblock %}

{% block title %}{{ titulo }} — VitalLife{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="card shadow-sm" style="max-width: 800px; margin: auto;">
        <div class="card-header bg-light py-3">
            <h4 class="mb-0">{{ titulo }}</h4>
        </div>
        <div class="card-body p-4">
            <form method="post">
                {% csrf_token %}
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="{{ form.nombre.id_for_label }}" class="form-label fw-bold">{{ form.nombre.label }}</label>
                        {{ form.nombre }}
                        {% if form.nombre.errors %}<div class="text-danger small mt-1">{{ form.nombre.errors|striptags }}</div>{% endif %}
                    </div>
                    <div class="col-md-6">
                        <label for="{{ form.apellido.id_for_label }}" class="form-label fw-bold">{{ form.apellido.label }}</label>
                        {{ form.apellido }}
                        {% if form.apellido.errors %}<div class="text-danger small mt-1">{{ form.apellido.errors|striptags }}</div>{% endif %}
                    </div>
                    <div class="col-12">
                        <label for="{{ form.email.id_for_label }}" class="form-label fw-bold">{{ form.email.label }}</label>
                        {{ form.email }}
                        {% if form.email.errors %}<div class="text-danger small mt-1">{{ form.email.errors|striptags }}</div>{% endif %}
                    </div>
                    <div class="col-md-6">
                        <label for="{{ form.rut.id_for_label }}" class="form-label fw-bold">{{ form.rut.label }}</label>
                        {{ form.rut }}
                        {% if form.rut.errors %}<div class="text-danger small mt-1">{{ form.rut.errors|striptags }}</div>{% endif %}
                    </div>
                    <div class="col-md-6">
                        <label for="{{ form.telefono.id_for_label }}" class="form-label fw-bold">{{ form.telefono.label }}</label>
                        {{ form.telefono }}
                        {% if form.telefono.errors %}<div class="text-danger small mt-1">{{ form.telefono.errors|striptags }}</div>{% endif %}
                    </div>
                    <div class="col-md-6">
                        <label for="{{ form.role.id_for_label }}" class="form-label fw-bold">{{ form.role.label }}</label>
                        {{ form.role }}
                        {% if form.role.errors %}<div class="text-danger small mt-1">{{ form.role.errors|striptags }}</div>{% endif %}
                    </div>
                    <div class="col-md-6" id="campo-especialidad" style="display: none;">
                        <label for="{{ form.especialidad.id_for_label }}" class="form-label fw-bold">{{ form.especialidad.label }}</label>
                        {{ form.especialidad }}
                        <div class="form-text">Asigna una especialidad a este médico.</div>
                        {% if form.especialidad.errors %}<div class="text-danger small mt-1">{{ form.especialidad.errors|striptags }}</div>{% endif %}
                    </div>
                    <div class="col-12 d-flex align-items-end">
                        <div class="form-check form-switch">
                            {{ form.is_active }}
                            <label class="form-check-label" for="{{ form.is_active.id_for_label }}">
                                Cuenta activa (Marcar para permitir el inicio de sesión)
                            </label>
                        </div>
                    </div>
                </div>

                <hr class="my-4">

                <div class="d-flex justify-content-end gap-2">
                    <a href="{% url 'paneladmin:lista_usuarios' %}" class="btn btn-light">Cancelar</a>
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const rolSelect = document.getElementById('{{ form.role.id_for_label }}');
    const especialidadCampo = document.getElementById('campo-especialidad');

    function toggleEspecialidad() {
        if (rolSelect.value === 'MEDICO') {
            especialidadCampo.style.display = 'block';
        } else {
            especialidadCampo.style.display = 'none';
        }
    }

    // Ejecutar al cargar la página
    toggleEspecialidad();

    // Ejecutar cada vez que cambie el rol
    rolSelect.addEventListener('change', toggleEspecialidad);
});
</script>
{% endblock %}